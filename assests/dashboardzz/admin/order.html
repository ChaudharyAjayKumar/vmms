<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management - Admin Dashboard</title>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link rel="stylesheet" as="style" onload="this.rel='stylesheet'" href="https://fonts.googleapis.com/css2?display=swap&amp;family=Inter%3Awght%40400%3B500%3B600%3B700%3B900&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style type="text/tailwindcss">
        :root {
            --primary-50: #eef7ff;
            --primary-100: #d8ecff;
            --primary-200: #badfff;
            --primary-300: #8ecfff;
            --primary-400: #5bb2ff;
            --primary-500: #338eff;
            --primary-600: #0d7ff2;
            --primary-700: #0060d1;
            --primary-800: #0852b4;
            --primary-900: #0b448a;
            --primary-950: #0c2b54;
        }
        .status-badge { @apply inline-block px-3 py-1 text-xs font-semibold rounded-full capitalize; }
        .status-pending { @apply bg-yellow-100 text-yellow-800; }
        .status-confirmed { @apply bg-blue-100 text-blue-800; }
        .status-delivered { @apply bg-green-100 text-green-800; }
        .status-cancelled { @apply bg-red-100 text-red-800; }
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }
        .modal-content::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .modal-enter {
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 200ms ease-in-out, transform 200ms ease-in-out;
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -1.5rem;
            top: 0.5rem;
            width: 10px;
            height: 10px;
            background: var(--primary-600);
            border-radius: 50%;
            border: 2px solid var(--primary-200);
        }
        .timeline-item:not(:last-child)::after {
            content: '';
            position: absolute;
            left: -1.25rem;
            top: 1.25rem;
            width: 2px;
            height: calc(100% - 0.75rem);
            background: var(--primary-200);
        }
    </style>
</head>
<body class="bg-slate-50 font-sans">
    <div class="relative flex size-full min-h-screen flex-col group/design-root overflow-x-hidden">
        <div class="layout-container flex h-full grow flex-col">
            <!-- HEADER -->
            <header class="flex items-center justify-between whitespace-nowrap border-b border-slate-200 bg-white px-4 sm:px-10 py-3 shadow-sm sticky top-0 z-30">
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-4 text-[#111418]">
                        <div class="size-6 text-[var(--primary-600)]">
                            <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M24 18.4228L42 11.475V34.3663C42 34.7796 41.7457 35.1504 41.3601 35.2992L24 42V18.4228Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M24 8.18819L33.4123 11.574L24 15.2071L14.5877 11.574L24 8.18819ZM9 15.8487L21 20.4805V37.6263L9 32.9945V15.8487ZM27 37.6263V20.4805L39 15.8487V32.9945L27 37.6263ZM25.354 2.29885C24.4788 1.98402 23.5212 1.98402 22.646 2.29885L4.98454 8.65208C3.7939 9.08038 3 10.2097 3 11.475V34.3663C3 36.0196 4.01719 37.5026 5.55962 38.098L22.9197 44.7987C23.6149 45.0671 24.3851 45.0671 25.0803 44.7987L42.4404 38.098C43.9828 37.5026 45 36.0196 45 34.3663V11.475C45 10.2097 44.2061 9.08038 43.0155 8.65208L25.354 2.29885Z" fill="currentColor"></path></svg>
                        </div>
                        <h2 class="text-slate-900 text-lg font-bold leading-tight tracking-tight">SATYA TRADERS</h2>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <button id="refreshBtn" class="bg-[var(--primary-600)] text-white px-4 py-2 rounded-md hover:bg-[var(--primary-700)] text-sm font-semibold">Refresh</button>
                </div>
            </header>

            <!-- MAIN CONTENT -->
            <main class="p-6 max-w-7xl mx-auto space-y-10">
                <!-- Date-Based Orders -->
                <section>
                    <h1 class="text-3xl font-bold text-slate-900 mb-6">Order Management</h1>
                    <nav class="flex space-x-4 border-b mb-4 text-sm font-medium text-gray-600">
                        <button class="tabBtn px-3 py-2 border-b-2 border-[var(--primary-600)] text-[var(--primary-700)]" data-tab="yesterday">Yesterday</button>
                        <button class="tabBtn px-3 py-2 border-b-2 border-transparent hover:border-gray-300" data-tab="today">Today</button>
                        <button class="tabBtn px-3 py-2 border-b-2 border-transparent hover:border-gray-300" data-tab="tomorrow">Tomorrow</button>
                        <button class="tabBtn px-3 py-2 border-b-2 border-transparent hover:border-gray-300" data-tab="all">All Orders</button>
                    </nav>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                        <input id="searchOrders" type="text" placeholder="Search by Order ID, Vendor..." class="border border-slate-300 rounded-md px-3 py-2 w-full focus:ring-[var(--primary-500)] focus:border-[var(--primary-500)]">
                        <select id="statusFilter" class="border border-slate-300 rounded-md px-3 py-2">
                            <option value="">All Statuses</option>
                            <option value="Pending">Pending</option>
                            <option value="Confirmed">Confirmed</option>
                            <option value="Delivered">Delivered</option>
                            <option value="Cancelled">Cancelled</option>
                        </select>
                        <input type="date" id="dateFilterStart" class="border border-slate-300 rounded-md px-3 py-2">
                        <input type="date" id="dateFilterEnd" class="border border-slate-300 rounded-md px-3 py-2">
                    </div>
                    <div id="ordersTableContainer" class="overflow-x-auto bg-white rounded-lg shadow border border-slate-200">
                        <table class="min-w-full table-auto">
                            <thead class="bg-slate-50 text-xs uppercase text-slate-500">
                                <tr>
                                    <th class="px-4 py-3 text-left">Order ID</th>
                                    <th class="px-4 py-3 text-left">Vendor</th>
                                    <th class="px-4 py-3 text-left">Order Date</th>
                                    <th class="px-4 py-3 text-left">Delivery Date</th>
                                    <th class="px-4 py-3 text-left">Status</th>
                                    <th class="px-4 py-3 text-left">Due Amount</th>
                                    <th class="px-4 py-3 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ordersBody" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </section>

                <!-- Due Orders Section -->
                <section>
                    <h2 class="text-2xl font-semibold text-gray-900 mb-4">Due Orders</h2>
                    <div id="dueOrdersContainer" class="overflow-x-auto bg-white rounded-lg shadow border border-slate-200">
                        <table class="min-w-full table-auto">
                            <thead class="bg-slate-50 text-xs uppercase text-slate-500">
                                <tr>
                                    <th class="px-4 py-3 text-left">Order ID</th>
                                    <th class="px-4 py-3 text-left">Vendor</th>
                                    <th class="px-4 py-3 text-left">Due Amount</th>
                                    <th class="px-4 py-3 text-left">Days Due</th>
                                    <th class="px-4 py-3 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="dueOrdersBody" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </section>

                <!-- Completed Orders Section -->
                <section>
                    <h2 class="text-2xl font-semibold text-gray-900 mb-4">Completed Orders</h2>
                    <div id="completedOrdersContainer" class="overflow-x-auto bg-white rounded-lg shadow border border-slate-200">
                        <table class="min-w-full table-auto">
                            <thead class="bg-slate-50 text-xs uppercase text-slate-500">
                                <tr>
                                    <th class="px-4 py-3 text-left">Order ID</th>
                                    <th class="px-4 py-3 text-left">Vendor</th>
                                    <th class="px-4 py-3 text-left">Delivery Date</th>
                                    <th class="px-4 py-3 text-left">Payment Status</th>
                                    <th class="px-4 py-3 text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="completedOrdersBody" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </section>
            </main>

            <!-- Edit Order Modal -->
            <div id="editOrderModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center p-4">
                <div class="modal-content bg-white rounded-lg w-full max-w-lg p-8 shadow-2xl max-h-[90vh] overflow-y-auto transform modal-enter">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-slate-900">Edit Order</h3>
                        <button onclick="closeEditOrderModal()" class="text-slate-500 hover:text-[var(--primary-600)] transition-colors duration-200">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="editOrderContent" class="text-sm space-y-4"></div>
                </div>
            </div>

            <!-- Delete Order Confirmation Modal -->
            <div id="deleteOrderModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-lg w-full max-w-sm p-6 shadow-lg">
                    <h3 class="text-xl font-semibold mb-4">Confirm Delete Order</h3>
                    <p id="deleteOrderMessage" class="mb-6"></p>
                    <div class="flex justify-end gap-4">
                        <button class="px-4 py-2 border rounded-md hover:bg-gray-100" onclick="closeDeleteOrderModal()">Cancel</button>
                        <button id="deleteOrderConfirmBtn" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">Delete</button>
                    </div>
                </div>
            </div>

            <!-- Assign Delivery Modal -->
            <div id="assignDeliveryModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-lg w-full max-w-sm p-6 shadow-lg">
                    <h3 class="text-xl font-semibold mb-4">Assign Delivery</h3>
                    <p class="mb-4">Select a delivery partner and date:</p>
                    <select id="deliveryPartnerSelect" class="border border-slate-300 rounded-md px-3 py-2 w-full mb-4">
                        <option value="">Select a partner</option>
                    </select>
                    <input type="date" id="deliveryDateSelect" class="border border-slate-300 rounded-md px-3 py-2 w-full mb-4">
                    <div class="flex justify-end gap-4">
                        <button class="px-4 py-2 border rounded-md hover:bg-gray-100" onclick="closeAssignDeliveryModal()">Cancel</button>
                        <button id="assignDeliveryConfirmBtn" class="px-4 py-2 bg-[var(--primary-600)] text-white rounded-md hover:bg-[var(--primary-700)]">Assign</button>
                    </div>
                </div>
            </div>

            <!-- Order Details Modal -->
            <div id="orderDetailsModal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-50 flex items-center justify-center p-4">
                <div class="modal-content bg-white rounded-lg w-full max-w-lg p-8 shadow-2xl max-h-[90vh] overflow-y-auto transform modal-enter">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-slate-900">Order Details</h3>
                        <button onclick="closeOrderDetailsModal()" class="text-slate-500 hover:text-[var(--primary-600)] transition-colors duration-200">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="orderDetailsContent" class="text-sm space-y-6"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* --------- Mock Data ----------- */
        const orders = [
            { 
                id: 'ORD1001', 
                vendor: 'Acme Corp', 
                orderDate: '2025-08-30', 
                deliveryDate: '2025-08-31', 
                status: 'Pending', 
                due: 50.00, 
                paymentStatus: 'Partial', 
                deliveryPartner: null, 
                items: [{ product: 'Widget A', quantity: 5, price: 10.00 }], 
                timeline: ['Order Placed: 2025-08-30 09:00', 'Pending Confirmation'], 
                paymentHistory: [{ date: '2025-08-30', amount: 50.00, method: 'UPI' }]
            },
            { 
                id: 'ORD1002', 
                vendor: 'Globex', 
                orderDate: '2025-08-31', 
                deliveryDate: '2025-08-31', 
                status: 'Delivered', 
                due: 0, 
                paymentStatus: 'Paid', 
                deliveryPartner: 'Ravi Kumar', 
                items: [{ product: 'Gadget B', quantity: 2, price: 25.00 }], 
                timeline: ['Order Placed: 2025-08-31 10:00', 'Confirmed: 2025-08-31 10:30', 'Out for Delivery: 2025-08-31 11:00', 'Delivered: 2025-08-31 12:00'], 
                paymentHistory: [{ date: '2025-08-31', amount: 50.00, method: 'Credit Card' }]
            },
            { 
                id: 'ORD1003', 
                vendor: 'Acme Corp', 
                orderDate: '2025-08-29', 
                deliveryDate: '2025-08-30', 
                status: 'Delivered', 
                due: 0, 
                paymentStatus: 'Paid', 
                deliveryPartner: 'Mohit Sharma', 
                items: [{ product: 'Tool C', quantity: 10, price: 15.00 }], 
                timeline: ['Order Placed: 2025-08-29 08:00', 'Confirmed: 2025-08-29 08:30', 'Out for Delivery: 2025-08-30 09:00', 'Delivered: 2025-08-30 10:30'], 
                paymentHistory: [{ date: '2025-08-30', amount: 150.00, method: 'Bank Transfer' }]
            },
            { 
                id: 'ORD1004', 
                vendor: 'Innotech', 
                orderDate: '2025-08-31', 
                deliveryDate: '2025-09-01', 
                status: 'Confirmed', 
                due: 100.00, 
                paymentStatus: 'Partial', 
                deliveryPartner: 'Soni Singh', 
                items: [{ product: 'Device D', quantity: 3, price: 50.00 }], 
                timeline: ['Order Placed: 2025-08-31 11:00', 'Confirmed: 2025-08-31 11:30'], 
                paymentHistory: [{ date: '2025-08-31', amount: 50.00, method: 'UPI' }]
            }
        ];

        const deliveryPartners = [
            { id: 201, name: 'Ravi Kumar', status: 'OnDuty', blocked: false },
            { id: 202, name: 'Soni Singh', status: 'Offline', blocked: true },
            { id: 203, name: 'Mohit Sharma', status: 'OnDuty', blocked: false }
        ];

        /* --------- Date Utilities --------- */
        function getYesterday() {
            const d = new Date();
            d.setDate(d.getDate() - 1);
            return d.toISOString().slice(0, 10);
        }
        function getToday() {
            return new Date().toISOString().slice(0, 10);
        }
        function getTomorrow() {
            const d = new Date();
            d.setDate(d.getDate() + 1);
            return d.toISOString().slice(0, 10);
        }

        function calculateDaysDue(deliveryDate) {
            const currentDate = new Date('2025-09-01');
            const delivery = new Date(deliveryDate);
            const diffTime = currentDate - delivery;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays > 0 ? diffDays : 0;
        }

        /* --------- Render Functions --------- */
        function renderOrders() {
            const searchTerm = document.getElementById('searchOrders').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const dateStart = document.getElementById('dateFilterStart').value;
            const dateEnd = document.getElementById('dateFilterEnd').value;
            const tbody = document.getElementById('ordersBody');
            const dateFilter = { yesterday: getYesterday(), today: getToday(), tomorrow: getTomorrow(), all: null };
            const selectedDate = dateFilter[currentTab];

            const filtered = orders.filter(o => (
                (!selectedDate || o.deliveryDate === selectedDate) &&
                (!searchTerm || o.id.toLowerCase().includes(searchTerm) || o.vendor.toLowerCase().includes(searchTerm)) &&
                (!statusFilter || o.status === statusFilter) &&
                (!dateStart || o.orderDate >= dateStart) &&
                (!dateEnd || o.orderDate <= dateEnd)
            ));

            if (filtered.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7" class="p-4 text-center text-gray-500">No orders found.</td></tr>`;
                return;
            }

            tbody.innerHTML = filtered.map(o => `
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3 text-sm text-gray-900">${o.id}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${o.vendor}</td>
                    <td class="px-4 py-3 text-sm text-gray-500">${o.orderDate}</td>
                    <td class="px-4 py-3 text-sm text-gray-500">${o.deliveryDate}</td>
                    <td class="px-4 py-3 text-sm"><span class="status-badge ${getStatusColor(o.status)}">${o.status}</span></td>
                    <td class="px-4 py-3 text-sm text-gray-500">₹${o.due.toFixed(2)}</td>
                    <td class="px-4 py-3 text-center text-sm font-medium space-x-2">
                        <button onclick="editOrder('${o.id}')" class="text-[var(--primary-600)] hover:underline">
                            <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                        </button>
                        ${o.status !== 'Delivered' && o.due > 0 ? `
                            <button onclick="deleteOrder('${o.id}')" class="text-red-600 hover:underline">
                                <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>` : ''}
                        <button onclick="assignDelivery('${o.id}')" class="text-green-600 hover:underline">
                            <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>
                        </button>
                        <button onclick="checkStatus('${o.id}')" class="text-gray-600 hover:underline">
                            <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0zM2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function renderDueOrders() {
            const tbody = document.getElementById('dueOrdersBody');
            const dueOrders = orders.filter(o => o.due > 0);
            if (dueOrders.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="p-4 text-center text-gray-500">No due orders.</td></tr>`;
                return;
            }
            tbody.innerHTML = dueOrders.map(o => `
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3 text-sm text-gray-900">${o.id}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${o.vendor}</td>
                    <td class="px-4 py-3 text-sm text-gray-500">₹${o.due.toFixed(2)}</td>
                    <td class="px-4 py-3 text-sm text-gray-500">${calculateDaysDue(o.deliveryDate)} days</td>
                    <td class="px-4 py-3 text-center text-sm font-medium">
                        <button onclick="checkStatus('${o.id}')" class="text-gray-600 hover:underline">
                            <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0zM2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function renderCompletedOrders() {
            const tbody = document.getElementById('completedOrdersBody');
            const completed = orders.filter(o => o.status === 'Delivered' && o.due === 0);
            if (completed.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="p-4 text-center text-gray-500">No completed orders.</td></tr>`;
                return;
            }
            tbody.innerHTML = completed.map(o => `
                <tr class="hover:bg-gray-50">
                    <td class="px-4 py-3 text-sm text-gray-900">${o.id}</td>
                    <td class="px-4 py-3 text-sm text-gray-900">${o.vendor}</td>
                    <td class="px-4 py-3 text-sm text-gray-500">${o.deliveryDate}</td>
                    <td class="px-4 py-3 text-sm"><span class="status-badge status-delivered">${o.paymentStatus}</span></td>
                    <td class="px-4 py-3 text-center text-sm font-medium">
                        <button onclick="checkStatus('${o.id}')" class="text-gray-600 hover:underline">
                            <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0zM2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusColor(status) {
            if (status === 'Delivered') return 'status-delivered';
            if (status === 'Pending') return 'status-pending';
            if (status === 'Confirmed') return 'status-confirmed';
            return 'status-cancelled';
        }

        /* --------- Modal Handling --------- */
        function editOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            document.getElementById('editOrderContent').innerHTML = `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Order ID</label>
                        <input type="text" value="${order.id}" disabled class="mt-1 block w-full border border-slate-300 rounded-md px-3 py-2 bg-gray-100">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Vendor</label>
                        <input type="text" value="${order.vendor}" disabled class="mt-1 block w-full border border-slate-300 rounded-md px-3 py-2 bg-gray-100">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Items</label>
                        ${order.items.map((item, index) => `
                            <div class="flex gap-4 mt-2">
                                <input type="text" value="${item.product}" disabled class="flex-1 border border-slate-300 rounded-md px-3 py-2 bg-gray-100">
                                <input type="number" id="item-quantity-${index}" value="${item.quantity}" min="1" class="w-24 border border-slate-300 rounded-md px-3 py-2">
                            </div>
                        `).join('')}
                    </div>
                    <div class="flex justify-end gap-4">
                        <button onclick="closeEditOrderModal()" class="px-4 py-2 border rounded-md hover:bg-gray-100">Cancel</button>
                        <button onclick="saveOrder('${order.id}')" class="px-4 py-2 bg-[var(--primary-600)] text-white rounded-md hover:bg-[var(--primary-700)]">Save</button>
                    </div>
                </div>
            `;
            const modal = document.getElementById('editOrderModal');
            const modalContent = modal.querySelector('.modal-content');
            modal.classList.remove('hidden');
            setTimeout(() => modalContent.classList.add('modal-enter-active'), 10);
        }

        function closeEditOrderModal() {
            const modal = document.getElementById('editOrderModal');
            const modalContent = modal.querySelector('.modal-content');
            modalContent.classList.remove('modal-enter-active');
            setTimeout(() => modal.classList.add('hidden'), 200);
        }

        function saveOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            order.items.forEach((item, index) => {
                const quantityInput = document.getElementById(`item-quantity-${index}`);
                const newQuantity = parseInt(quantityInput.value);
                if (newQuantity >= 1) {
                    item.quantity = newQuantity;
                    // Update due amount based on new quantities (simulated)
                    order.due = order.items.reduce((sum, item) => sum + item.quantity * item.price, 0) - order.paymentHistory.reduce((sum, p) => sum + p.amount, 0);
                }
            });
            closeEditOrderModal();
            renderOrders();
            renderDueOrders();
            renderCompletedOrders();
            showSuccessMessage(`Order ${orderId} updated successfully.`);
        }

        function deleteOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (order.status === 'Delivered' || order.due === 0) {
                alert('Cannot delete delivered or fully paid orders.');
                return;
            }
            document.getElementById('deleteOrderMessage').textContent = `Are you sure you want to delete order "${orderId}"? This action cannot be undone.`;
            document.getElementById('deleteOrderConfirmBtn').onclick = function() {
                const index = orders.findIndex(o => o.id === orderId);
                orders.splice(index, 1);
                closeDeleteOrderModal();
                renderOrders();
                renderDueOrders();
                renderCompletedOrders();
                showSuccessMessage(`Order ${orderId} deleted successfully.`);
            };
            const modal = document.getElementById('deleteOrderModal');
            modal.classList.remove('hidden');
            setTimeout(() => modal.querySelector('.bg-white').classList.add('modal-enter-active'), 10);
        }

        function closeDeleteOrderModal() {
            const modal = document.getElementById('deleteOrderModal');
            const modalContent = modal.querySelector('.bg-white');
            modalContent.classList.remove('modal-enter-active');
            setTimeout(() => modal.classList.add('hidden'), 200);
        }

        function assignDelivery(orderId) {
            const order = orders.find(o => o.id === orderId);
            const select = document.getElementById('deliveryPartnerSelect');
            select.innerHTML = '<option value="">Select a partner</option>' + 
                deliveryPartners
                    .filter(p => !p.blocked && p.status === 'OnDuty')
                    .map(p => `<option value="${p.name}">${p.name} (${p.status})</option>`)
                    .join('');
            document.getElementById('deliveryDateSelect').value = order.deliveryDate;
            document.getElementById('assignDeliveryConfirmBtn').onclick = function() {
                const partner = select.value;
                const deliveryDate = document.getElementById('deliveryDateSelect').value;
                if (!partner || !deliveryDate) {
                    alert('Please select a delivery partner and date.');
                    return;
                }
                order.deliveryPartner = partner;
                order.deliveryDate = deliveryDate;
                if (order.status === 'Pending') order.status = 'Confirmed';
                closeAssignDeliveryModal();
                renderOrders();
                renderDueOrders();
                renderCompletedOrders();
                showSuccessMessage(`Delivery assigned for order ${orderId}.`);
            };
            const modal = document.getElementById('assignDeliveryModal');
            modal.classList.remove('hidden');
            setTimeout(() => modal.querySelector('.bg-white').classList.add('modal-enter-active'), 10);
        }

        function closeAssignDeliveryModal() {
            const modal = document.getElementById('assignDeliveryModal');
            const modalContent = modal.querySelector('.bg-white');
            modalContent.classList.remove('modal-enter-active');
            setTimeout(() => modal.classList.add('hidden'), 200);
        }

        function checkStatus(orderId) {
            const order = orders.find(o => o.id === orderId);
            const totalAmount = order.items.reduce((sum, item) => sum + item.quantity * item.price, 0);
            document.getElementById('orderDetailsContent').innerHTML = `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div class="flex items-center">
                            <svg class="w-5 h-5 text-[var(--primary-600)] mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
                            <div>
                                <span class="text-xs font-medium text-slate-500">Order ID</span>
                                <p class="text-base font-semibold text-slate-900">${order.id}</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <svg class="w-5 h-5 text-[var(--primary-600)] mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
                            <div>
                                <span class="text-xs font-medium text-slate-500">Vendor</span>
                                <p class="text-base font-semibold text-slate-900">${order.vendor}</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <svg class="w-5 h-5 text-[var(--primary-600)] mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                            <div>
                                <span class="text-xs font-medium text-slate-500">Order Date</span>
                                <p class="text-base font-semibold text-slate-900">${order.orderDate}</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <svg class="w-5 h-5 text-[var(--primary-600)] mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>
                            <div>
                                <span class="text-xs font-medium text-slate-500">Delivery Date</span>
                                <p class="text-base font-semibold text-slate-900">${order.deliveryDate}</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <svg class="w-5 h-5 text-[var(--primary-600)] mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            <div>
                                <span class="text-xs font-medium text-slate-500">Status</span>
                                <p class="text-base"><span class="status-badge ${getStatusColor(order.status)}">${order.status}</span></p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <svg class="w-5 h-5 text-[var(--primary-600)] mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                            <div>
                                <span class="text-xs font-medium text-slate-500">Due Amount</span>
                                <p class="text-base font-semibold text-slate-900">₹${order.due.toFixed(2)}</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-slate-900 mb-3">Items</h4>
                        <ul class="space-y-2">
                            ${order.items.map(item => `
                                <li class="text-sm text-slate-600">${item.product} (Qty: ${item.quantity}, Price: ₹${item.price.toFixed(2)})</li>
                            `).join('')}
                        </ul>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-slate-900 mb-3">Payment Credentials</h4>
                        <div class="space-y-2">
                            <p class="text-sm text-slate-600">Total Amount: ₹${totalAmount.toFixed(2)}</p>
                            <p class="text-sm text-slate-600">Paid Amount: ₹${order.paymentHistory.reduce((sum, p) => sum + p.amount, 0).toFixed(2)}</p>
                            <p class="text-sm text-slate-600">Due Amount: ₹${order.due.toFixed(2)}</p>
                            <p class="text-sm text-slate-600">Payment Status: <span class="status-badge ${order.paymentStatus === 'Paid' ? 'status-delivered' : 'status-pending'}">${order.paymentStatus}</span></p>
                            <h5 class="text-sm font-medium text-slate-700 mt-4">Payment History</h5>
                            <ul class="space-y-2">
                                ${order.paymentHistory.length > 0 ? order.paymentHistory.map(p => `
                                    <li class="text-sm text-slate-600">${p.date}: ₹${p.amount.toFixed(2)} via ${p.method}</li>
                                `).join('') : '<li class="text-sm text-slate-600">No payments recorded.</li>'}
                            </ul>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-slate-900 mb-3">Timeline</h4>
                        <ul class="relative pl-6 space-y-3">
                            ${order.timeline.map(step => `
                                <li class="relative timeline-item text-sm ${step.includes('Cancelled') ? 'text-red-600' : 'text-slate-600'}">${step}</li>
                            `).join('')}
                        </ul>
                    </div>
                </div>
            `;
            const modal = document.getElementById('orderDetailsModal');
            const modalContent = modal.querySelector('.modal-content');
            modal.classList.remove('hidden');
            setTimeout(() => modalContent.classList.add('modal-enter-active'), 10);
        }

        function closeOrderDetailsModal() {
            const modal = document.getElementById('orderDetailsModal');
            const modalContent = modal.querySelector('.modal-content');
            modalContent.classList.remove('modal-enter-active');
            setTimeout(() => modal.classList.add('hidden'), 200);
        }

        function showSuccessMessage(message) {
            const successMessage = document.createElement('div');
            successMessage.className = 'fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded-md shadow-lg';
            successMessage.textContent = message;
            document.body.appendChild(successMessage);
            setTimeout(() => successMessage.remove(), 3000);
        }

        /* --------- Event Handlers --------- */
        let currentTab = 'today';
        document.querySelectorAll('.tabBtn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tabBtn').forEach(b => b.classList.remove('border-[var(--primary-600)]', 'text-[var(--primary-700)]'));
                btn.classList.add('border-[var(--primary-600)]', 'text-[var(--primary-700)]');
                currentTab = btn.getAttribute('data-tab');
                renderOrders();
            });
        });

        document.getElementById('searchOrders').addEventListener('input', renderOrders);
        document.getElementById('statusFilter').addEventListener('change', renderOrders);
        document.getElementById('dateFilterStart').addEventListener('change', renderOrders);
        document.getElementById('dateFilterEnd').addEventListener('change', renderOrders);

        document.getElementById('refreshBtn').addEventListener('click', () => {
            document.getElementById('searchOrders').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('dateFilterStart').value = '';
            document.getElementById('dateFilterEnd').value = '';
            renderOrders();
            renderDueOrders();
            renderCompletedOrders();
        });

        /* --------- Initialize --------- */
        document.querySelector(`button[data-tab="${currentTab}"]`).classList.add('border-[var(--primary-600)]', 'text-[var(--primary-700)]');
        renderOrders();
        renderDueOrders();
        renderCompletedOrders();
    </script>
</body>
</html>